<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ParcAuto_Web_App.ViewModels"
             xmlns:models="clr-namespace:ParcAuto_Web_App.Models"
             xmlns:sys="clr-namespace:System;assembly=netstandard"
             x:Class="ParcAuto_Web_App.Views.ReservationEditPage"
             x:DataType="viewmodels:ReservationEditViewModel"
             Title="{Binding IsEditMode, Converter={StaticResource EditModeTitleConverter}}">
    
    <ScrollView Padding="20">
        <VerticalStackLayout Spacing="15">

            <!-- Error Message -->
            <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                   BackgroundColor="#FFEBEE"
                   BorderColor="Red"
                   Padding="10"
                   Margin="0,0,0,10">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="Red"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </Frame>

            <!-- Vehicle Picker -->
            <Label Text="Vehicle *" FontAttributes="Bold"/>
            <Picker ItemsSource="{Binding Vehicles}"
                    SelectedItem="{Binding SelectedVehicle}"
                    ItemDisplayBinding="{Binding DisplayName}"
                    Title="Select a vehicle"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Driver Picker -->
            <Label Text="Driver *" FontAttributes="Bold"/>
            <Picker ItemsSource="{Binding Drivers}"
                    SelectedItem="{Binding SelectedDriver}"
                    ItemDisplayBinding="{Binding FullName}"
                    Title="Select a driver"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Start Date -->
            <Label Text="Start Date *" FontAttributes="Bold"/>
            <DatePicker Date="{Binding StartDate}"
                       MinimumDate="{x:Static sys:DateTime.Now}"
                       IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Start Time -->
            <Label Text="Start Time *" FontAttributes="Bold"/>
            <TimePicker Time="{Binding StartTime}"
                       IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- End Date -->
            <Label Text="End Date *" FontAttributes="Bold"/>
            <Label Text="(Must be after start date)"
                   FontSize="12"
                   TextColor="Gray"
                   Margin="0,-10,0,0"/>
            <DatePicker Date="{Binding EndDate}"
                       MinimumDate="{Binding StartDate}"
                       IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- End Time -->
            <Label Text="End Time *" FontAttributes="Bold"/>
            <TimePicker Time="{Binding EndTime}"
                       IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Purpose -->
            <Label Text="Purpose *" FontAttributes="Bold"/>
            <Editor Text="{Binding Purpose}"
                   Placeholder="Enter purpose (required)"
                   HeightRequest="100"
                   IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Status -->
            <Label Text="Status *" FontAttributes="Bold"/>
            <Picker SelectedItem="{Binding Status}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Pending</x:String>
                        <x:String>Approved</x:String>
                        <x:String>Active</x:String>
                        <x:String>Completed</x:String>
                        <x:String>Cancelled</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Label Text="* Required fields"
                   FontSize="12"
                   TextColor="Gray"
                   Margin="0,10,0,0"/>

            <!-- Action Buttons -->
            <Button Text="Save"
                    Command="{Binding SaveReservationCommand}"
                    BackgroundColor="{StaticResource Primary}"
                    TextColor="White"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                    Margin="0,20,0,0"/>

            <Button Text="Cancel"
                    Command="{Binding CancelCommand}"
                    BackgroundColor="Transparent"
                    TextColor="{StaticResource Primary}"
                    BorderColor="{StaticResource Primary}"
                    BorderWidth="1"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"/>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              IsVisible="{Binding IsBusy}"
                              HorizontalOptions="Center"
                              Color="{StaticResource Primary}"/>
        </VerticalStackLayout>
    </ScrollView>
    
</ContentPage>
